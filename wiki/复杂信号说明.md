# 复杂信号说明

## _sel_dm_we

- 类型：流水线控制信号
- 位宽：1
- 描述：选择dm写指令最终是否写dm
- 详细描述
	|宏定义|操作描述|对应指令|
	|:---:|:----:|:---:|
	|EXC_MUX2_DM_WE			|选择正常的dm写使能表示未发生异常			||
	|EXC_MUX2_1CONSTANT0	|选择使能禁止表示发生异常				||

## _sel_npc

- 类型：流水线控制信号
- 位宽：5
- 描述：选择下一条指令的地址
- 信号来源：{rst/FLASH.flash_[0]/STALL.stall_[0]/ID.ID_CU.jb_/EX.EX_AND1.bb_}
- 宏定义及对应的指令
	|宏定义名称|宏内容|描述		|
	|:---:|:----:|:---:|
	|RSTPC		|!_sel_npc[0]	|pc硬件复位		|
	|FLASHPC	|_sel_npc[0] && _sel_npc[1]	|流水线冲刷	|
	|STALLPC	|_sel_npc[0] && !_sel_npc[1] && _sel_npc[2]	|流水线暂停	|
	|JBPC	|_sel_npc[0] && !_sel_npc[1] && !_sel_npc[2] && _sel_npc[3]	|J型分支指令跳转	|
	|BBPC	|_sel_npc[0] && !_sel_npc[1] && !_sel_npc[2] && !_sel_npc[3] && _sel_npc[4]	|B型分支指令跳转	|
	|NORMALPC	|_sel_npc[0] && !_sel_npc[1] && !_sel_npc[2] && !_sel_npc[3] && !_sel_npc[4]	|正常的pc+4|

## _sel_id_data

- 类型：流水线控制信号
- 位宽：3
- 描述：选择下一个始终周期ID阶段的数据
- 信号来源：{rst/FLASH.flash_[1]/STALL.stall[1]}
- 宏定义及对应的指令
	|宏定义名称|宏内容|描述		|
	|:---:|:----:|:---:|
	|RSTID	|!_sel_id_data[0]	|id阶段硬件复位		|
	|FLASHID	|_sel_id_data[0] && _sel_id_data[1]	|流水线冲刷id	|
	|STALLID	|_sel_id_data[0] && !_sel_id_data[1] && _sel_id_data[2]	|流水线暂停	|
	|NORMALID	|_sel_id_data[0] && !_sel_id_data[1] && !_sel_id_data[2]	|正常情况	|

## _sel_ex_data

- 类型：流水线控制信号
- 位宽：3
- 描述：选择下一个始终周期EX阶段的数据
- 信号来源：{rst/FLASH.flash_[2]/STALL.stall[2]}
- 宏定义及对应的指令
	|宏定义名称|宏内容|描述		|
	|:---:|:----:|:---:|
	|RSTEX	|!_sel_ex_data[0]	|ex阶段硬件复位		|
	|FLASHEX	|_sel_ex_data[0] && _sel_ex_data[1]	|流水线冲刷ex	|
	|STALLEX	|_sel_ex_data[0] && !_sel_ex_data[1] && _sel_ex_data[2]	|流水线暂停	|
	|NORMALEX	|_sel_ex_data[0] && !_sel_ex_data[1] && !_sel_ex_data[2]	|正常情况	|

## _sel_exception_data

- 类型：流水线控制信号
- 位宽：3
- 描述：选择下一个始终周期EXCEPTION阶段的数据
- 信号来源：{rst/FLASH.flash_[3]/STALL.stall[3]}
- 宏定义及对应的指令
	|宏定义名称|宏内容|描述		|
	|:---:|:----:|:---:|
	|RSTEXCEPTION	|!_sel_exception_data[0]	|exception阶段硬件复位		|
	|FLASHEXCEPTION	|_sel_exception_data[0] && _sel_exception_data[1]	|流水线冲刷exception	|
	|STALLEXCEPTION	|_sel_exception_data[0] && !_sel_exception_data[1] && _sel_exception_data[2]	|流水线暂停	|
	|NORMALEXCEPTION	|_sel_exception_data[0] && !_sel_exception_data[1] && !_sel_exception_data[2]	|正常情况	|

## _sel_mem_data

- 类型：流水线控制信号
- 位宽：3
- 描述：选择下一个始终周期MEM阶段的数据
- 信号来源：{rst/FLASH.flash_[4]/STALL.stall[4]}
- 宏定义及对应的指令
	|宏定义名称|宏内容|描述		|
	|:---:|:----:|:---:|
	|RSTMEM	|!_sel_mem_data[0]	|mem阶段硬件复位		|
	|FLASHMEM	|_sel_mem_data[0] && _sel_mem_data[1]	|流水线冲刷mem	|
	|STALLMEM	|_sel_mem_data[0] && !_sel_mem_data[1] && _sel_mem_data[2]	|流水线暂停	|
	|NORMALMEM	|_sel_mem_data[0] && !_sel_mem_data[1] && !_sel_mem_data[2]	|正常情况	|

## _id_extend

- 类型：数据选择信号
- 位宽:3
- 描述：位拓展的方法
- 详细描述
	|宏定义|操作描述|对应指令|
	|:---:|:----:|:---:|
	|EXT_NOP			|无效信号			||
	|EXT_0_15_SIGN		|低16位有符号拓展	|ADDI,ADDIU,SLTI,SLTIU|
	|EXT_0_15_UNSIGN	|低16位无符号拓展	|ANDI,LUI,ORI,XORI|
	|EXT_6_10_UNSIGN	|6-10位无符号拓展	|SLL,SRA,SRL|
	|EXT_0_15_LEFT_SHIFT_2_SIGN|低16位左移两位符号拓展|BEQ,BNE,BGTZ,BLEZ,BLTZ,BGEZAL,BLTZAL|
	|EXT_0_25_LEFT_SHIFT_2_PC|低26位左移两位拼接PC高四位|J,JAL|

## _sel_dm_rdata

- 类型：数据选择信号
- 位宽：3
- 描述：选择dm读数据
- 详细描述
	|宏定义|操作描述|对应指令|
	|:---:|:----:|:---:|
	|DM_RDATA_NOP		|取失效			||
	|DM_RDATA_UNSIGN_BYTE|取一无符号字节|LBU|
	|DM_RDATA_SIGN_BYTE|取一有符号字节|LB|
	|DM_RDATA_UNSIGN_HW|取一无符号半字|LHU|
	|DM_RDATA_SIGN_HW|取一有符号半字|LH|
	|DM_RDATA_W|取一字|LW|

## _sel_dm_wdata

- 类型：数选择信号
- 位宽：3
- 描述：选择dm写数据
- 详细描述
	|宏定义|操作描述|对应指令|
	|:---:|:----:|:---:|
	|DM_WDATA_NOP		|写失效			||
	|DM_WDATA_BYTE|写一字节|SB|
	|DM_WDATA_HW|写一半字|SH|
	|DM_WDATA_W|写一字|SW|

## _sel_jb_target

- 类型：数据选择信号
- 位宽：2
- 描述：确定j类型跳转指令的目标地址
- 详细描述
	|宏定义|操作描述|对应指令|
	|:---:|:----:|:---:|
	|ID_MUX4_NOP	|选择_32constant0	||
	|ID_MUX4_IMM32	|选择_imm32			|J,JAL|
	|ID_MUX4_RS_DATA	|选择_rs_data	|JR,JALR|

## _sel_data1

- 类型：数据选择信号
- 位宽：3
- 描述：确定alu的原操作数1
- 详细描述
	|宏定义|操作描述|对应指令|
	|:---:|:----:|:---:|
	|ID_MUX2_NOP	|选择_32constant0	|MTC0|
	|ID_MUX2_32CONSTANT26	|选择_32constant16	|LUI|
	|ID_MUX2_IMM32			|选择_imm32			|SLL,SRA,SRL|
	|ID_MUX2_RS_DATA		|选择_rs_data		|ADD,ADDU,SUB,SUBU,SLT,SLTU,DIV,DIVU,MULT,MULTU,AND,NOR,OR,XOR,SLLV,SRAV,SRLV,ADDI,ADDIU,SLTI,SLTIU,ANDI,ORI,XORI,LB,LBU,LH,LHU,LW,SB,SH,SW,BEQ,BNE,BGEZ,BGTZ,BLEZ,BLTZ,BGEZAL,BLTZAL,MTHI,MTLO|
	|ID_MUX2_CP0_RD_DATA	|选择_cp0_rd_data	|MFC0	|

## _sel_data2

- 类型：数据选择信号
- 位宽：2
- 描述：确定alu的原操作数2
- 详细描述
	|宏定义|操作描述|对应指令|
	|:---:|:----:|:---:|
	|ID_MUX3_NOP	|选择_32constant0	|BGEZ,BGTZ,BLEZ,BLTZ,BGEZAL,BLTZAL,J,JAL,JR,JALR,MTHI,MTLO,MFC0,MTC0|
	|ID_MUX3_IMM32	|选择_imm32			|ADDI,ADDIU,SLTI,SLTIU,ANDI,ORI,XORI,LB,LBU,LH,LHU,LW,SB,SH,SW|
	|ID_MUX3_RT_DATA	|选择_rt_data	|ADD,ADDU,SUB,SUBU,SLT,SLTU,DIV,DIVU,MULT,MULTU,AND,NOR,OR,XOR,SLLV,SRAV,SRLV,LUI,SLL,SRA,SRL,BEQ,BNE,MTC0|

## _sel_exc_pc

- 类型：数据选择信号
- 位宽：2
- 描述：选择异常处理阶段要更新的pc值
- 详细描述
	|宏定义|操作描述|对应指令|
	|:---:|:----:|:---:|
	|EXC_MUX3_EPC			|选择EPC的值作为pc的新值			|ERET		|
	|EXC_MUX3_32CONSTANT	|选择约定的中断处理程序入口地址				|BREAK,SYSCALL,保留指令	|
	|EXC_MUX3_32CONSTANT0	|选择常数0（非中断指令）					||

------

## regfile写数据选择信号:sel_reg_wdata

- 信号描述:CPU.ID.CU产生信号用于选择CPU.WB.reg_wdata_
- 位宽:3
- 选择方式:4选一

|macro_definition|对应指令|
|:--:|:--:|
|CPU_WB_NOP		||
|CPU_WB_ALU_RES		|ADD,ADDI,ADDU,ADDIU,SUB,SUBU,SLT,SLTI,SLTU,ALTIU,AND,ANDI,LUI,NOR,OR,ORI,XOR,XORI,SLLV,SLL,SRAV,SRA,SRLV,SRL|
|CPU_WB_DELAYSLOT_ADDR	|BGEZAL,BLTAZL,JAL,JALR|
|CPU_WB_HI		|MFHI|
|CPU_WB_LO		|MFLO|
|CPU_WB_DM		|LB,LBU,LH,LHU,LW|

## regfile写地址选择信号:sel_reg_waddr

- 信号描述:CPU.ID.CU产生信号用于选择CPU.ID.REG_WDATA_MUX.reg_waddr_
- 位宽:2
- 选择方式:3选1

|macro_definition|对应指令|
|:---:|:----:|
|CPU_ID_REG_WDATA_MUX_NOP||
|CPU_ID_REG_WDATA_MUX_CONSTANT_31|BGEZAL,BLTZAL,JAL|
|CPU_ID_REG_WDATA_MUX_RD|ADD,ADDU,SUB,SUBU,SLT,SLTU,AND,NOR,OR,XOR,SLLV,SLL,SRAV,SRA,SRLV,SRL,JALR,MFHI,MFLO|
|CPU_ID_REG_WDATA_MUX_RT|ADDI,ADDIU,SLTI,SLTIU,ANDI,LUI,ORI,XORI,LB,LBU,LH,LHU,LW|


## hilo寄存器写使能:hilo_we

- 信号描述:CPU.ID.CU产生信号用于选择CPU.WB.HILO_CU.hi_,CPU.WB.HILO_CU.lo_
- 位宽:3

|macro_definition|操作描述|指令|
|:---:|:---:|:---:|
|CPU_WB_HILO_CU_HI_LO|hi和lo寄存器的值不变||
|CPU_WB_HILO_CU_MULT|乘法结果写入|MULT,MULTU|
|CPU_WB_HILO_CU_DIV|除法结果写入|DIV,DIVU|
|CPU_WB_HILO_CU_ALU_RES_LO|alu运算结果写入hi，lo寄存器不变|MTHI|
|CPU_WB_HILO_CU_HI_ALU_RES|alu运算结果写入lo，hi寄存器不变|MTLO|



## alu运算类型:alu_op

- 位宽:8

|macro_definition|指令|
|:-:|:-:|
|ALU_NOP||
|ALU_ADD|ADD,ADDI,MTHI,MTLO,LB,LBU,LH,LHU,LW,SB,SH,SW,MFC0,MTC0|
|ALU_SUB|SUB,SUBI|
|ALU_LESS_THAN_SIGN|SLT,SLTI		|
|ALU_LESS_THAN_UNSIGN|SLTU,SLTIU       |
|ALU_AND|AND,ANDI           |
|ALU_LEFT_SHIFT|LUI,SLL,SLLV                    |
|ALU_NOR|NOR                     |
|ALU_OR|OR,ORI               |
|ALU_XOR|XOR,XORI           |
|ALU_RIGHT_SHIFT_ARITHMETIC|SRAV,SRA           |
|ALU_RIGHT_SHIFT_LOGIC|SRLV,SRL           |
|ALU_EQUAL|BEQ                     |
|ALU_INEQUAL|BNE                     |
|ALU_GREAT_EQUAL_ZERO|BGEZ,BGEZAL     |
|ALU_GREAT_ZERO|BGTZ                   |
|ALU_LESS_ZERO|BLEZ                   |
|ALU_LESS_ZREO|BLTZ,BLTZAL     |
